<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simulador e Projeção de NPS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/prop-types@15.8.1/prop-types.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script crossorigin src="https://unpkg.com/recharts@2.8.0/umd/Recharts.js"></script>
  <style>
    /* Estilo para a fonte "Inter" */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f1f5f9; /* bg-slate-100 */
    }
    /* Cor primária (vermelho) e secundária (verde) */
    :root {
      --primary-red: #C51A3A;
      --success-green: #27ae60; /* Tom de verde moderno */
    }
  </style>
</head>
<body class="p-4 md:p-8">
  <div id="root"></div>

  <script type="text/babel">
    window.onload = function() {
      const { useState, useMemo } = React;
      const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;

      // --- Componentes de UI (Estilo ShadCN) ---
      const Card = ({ children, className }) => <div className={`rounded-xl border bg-white text-slate-900 shadow-md ${className}`}>{children}</div>;
      const CardHeader = ({ children, className }) => <div className={`flex flex-col space-y-1.5 p-6 ${className}`}>{children}</div>;
      const CardTitle = ({ children, className }) => <h3 className={`text-2xl font-semibold leading-none tracking-tight ${className}`}>{children}</h3>;
      const CardDescription = ({ children, className }) => <p className={`text-sm text-slate-500 ${className}`}>{children}</p>;
      const CardContent = ({ children, className }) => <div className={`p-6 pt-0 ${className}`}>{children}</div>;
      const Button = ({ children, className, ...props }) => <button className={`inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 px-4 py-2 ${className}`} {...props}>{children}</button>;
      const Input = ({ className, ...props }) => <input className={`flex h-10 w-full rounded-md border border-slate-200 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-slate-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${className}`} {...props} />;
      const Label = ({ children, ...props }) => <label className="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" {...props}>{children}</label>;

      const Tabs = ({ children, defaultValue }) => {
        const [activeTab, setActiveTab] = useState(defaultValue);
        return <div className="flex flex-col">{React.Children.map(children, child => React.cloneElement(child, { activeTab, setActiveTab }))}</div>;
      };
      const TabsList = ({ children, activeTab, setActiveTab }) => <div className="inline-flex h-10 items-center justify-center rounded-md bg-slate-200 p-1 text-slate-500">{React.Children.map(children, child => React.cloneElement(child, { activeTab, setActiveTab }))}</div>;
      const TabsTrigger = ({ children, value, activeTab, setActiveTab }) => (
        <button
          className={`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-4 py-1.5 text-sm font-semibold ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-950 focus-visible:ring-offset-2 ${activeTab === value ? 'bg-white text-red-600 shadow-sm' : 'text-slate-600 hover:text-slate-900'}`}
          onClick={() => setActiveTab(value)}
        >{children}</button>
      );
      const TabsContent = ({ children, value, activeTab }) => <div className={`${activeTab === value ? 'block' : 'hidden'} mt-4`}>{children}</div>;

      const App = () => {
        const initialCombinedData = [
          { month: 'Jan', prom: 990, neutr: 26, detra: 13, status: 'Fechado' },
          { month: 'Fev', prom: 975, neutr: 38, detra: 26, status: 'Fechado' },
          { month: 'Mar', prom: 1412, neutr: 48, detra: 44, status: 'Fechado' },
          { month: 'Abr', prom: 1396, neutr: 62, detra: 47, status: 'Fechado' },
          { month: 'Mai', prom: 1243, neutr: 86, detra: 51, status: 'Fechado' },
          { month: 'Jun', prom: 1334, neutr: 61, detra: 28, status: 'Fechado' }
        ];

        const allMonths = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
        
        const initialProjectionData = useMemo(() => {
          const lastFourMonths = initialCombinedData.slice(-4);
          const avgProm = Math.round(lastFourMonths.reduce((sum, d) => sum + d.prom, 0) / lastFourMonths.length);
          const avgNeutr = Math.round(lastFourMonths.reduce((sum, d) => sum + d.neutr, 0) / lastFourMonths.length);
          const avgDetra = Math.round(lastFourMonths.reduce((sum, d) => sum + d.detra, 0) / lastFourMonths.length);
          
          const fullData = [...initialCombinedData];
          for (let i = fullData.length; i < allMonths.length; i++) {
            fullData.push({ month: allMonths[i], prom: avgProm, neutr: avgNeutr, detra: avgDetra, status: 'Projetado' });
          }
          return fullData;
        }, []);

        const [data, setData] = useState(initialProjectionData);
        const [totalNotas, setTotalNotas] = useState(1000);
        const [inverseResults, setInverseResults] = useState([]);

        const calculateNps = (prom, detra, total) => total === 0 ? 0 : parseFloat(((prom - detra) / total) * 100).toFixed(1);

        const npsProjectionData = useMemo(() => data.map(d => {
          const totalVolume = d.prom + d.neutr + d.detra;
          const npsCx = calculateNps(d.prom, d.detra, totalVolume);
          return { ...d, totalVolume, npsCx };
        }), [data]);

        const annualTotals = useMemo(() => {
          const totals = npsProjectionData.reduce((acc, d) => {
            acc.totalProm += d.prom;
            acc.totalNeutr += d.neutr;
            acc.totalDetra += d.detra;
            acc.totalVolume += d.totalVolume;
            return acc;
          }, { totalProm: 0, totalNeutr: 0, totalDetra: 0, totalVolume: 0 });
          totals.annualNps = calculateNps(totals.totalProm, totals.totalDetra, totals.totalVolume);
          return totals;
        }, [npsProjectionData]);

        const handleProjectionChange = (index, type, value) => {
          const newData = [...data];
          newData[index][type] = parseInt(value, 10) || 0;
          setData(newData);
        };
        
        const handleInverseCalculation = () => {
          const targetNps = 95;
          const closedData = data.filter(d => d.status === 'Fechado');
          const initialTotalNotes = closedData.reduce((sum, d) => sum + d.totalVolume, 0);
          const initialTotalNeutrals = closedData.reduce((sum, d) => sum + d.neutr, 0);
          const neutralRatio = initialTotalNotes > 0 ? initialTotalNeutrals / initialTotalNotes : 0.05;

          const results = allMonths.map(month => {
            const neutrals = Math.round(totalNotas * neutralRatio);
            const promotersAndDetractors = totalNotas - neutrals;
            const promoters = Math.round((promotersAndDetractors + (targetNps / 100 * totalNotas)) / 2);
            const detractors = promotersAndDetractors - promoters;
            return {
              month,
              totalNotas,
              promotores: promoters,
              detratores: detractors,
              neutros: neutrals,
              npsCalculado: calculateNps(promoters, detractors, totalNotas),
            };
          });
          setInverseResults(results);
        };

        return (
          <div className="max-w-7xl mx-auto space-y-8">
            <Card>
              <CardHeader className="!p-0">
                  <div style={{backgroundColor: 'var(--primary-red)'}} className="p-8 rounded-t-xl">
                      <h1 className="text-4xl font-bold text-white">Você no Centro de tudo</h1>
                      <p className="text-white/80 mt-2">Temos uma equipe de <span className="font-bold">Ferramenta interativa para simular cenários e calcular metas de NPS.</p>
                      <p className="text-2xl font-semibold text-white mt-4">Simulador e Projeção de NPS</p>
                  </div>
              </CardHeader>
              <CardContent className="p-6">
                <Tabs defaultValue="projection">
                  <div className="flex justify-center">
                    <TabsList>
                      <TabsTrigger value="projection">Projeção de NPS</TabsTrigger>
                      <TabsTrigger value="inverse">Cálculo Inverso (Meta NPS 95)</TabsTrigger>
                    </TabsList>
                  </div>

                  <TabsContent value="projection">
                    <div className="mt-6 overflow-x-auto">
                      <table className="w-full text-sm">
                        <thead className="bg-slate-100">
                          <tr>
                            <th className="p-3 text-left font-semibold text-slate-600 rounded-l-lg">Mês</th>
                            <th className="p-3 text-center font-semibold text-slate-600">Promotores</th>
                            <th className="p-3 text-center font-semibold text-slate-600">Neutros</th>
                            <th className="p-3 text-center font-semibold text-slate-600">Detratores</th>
                            <th className="p-3 text-center font-semibold text-slate-600">Vol. Total</th>
                            <th className="p-3 text-center font-semibold text-slate-600 rounded-r-lg">NPS CX</th>
                          </tr>
                        </thead>
                        <tbody>
                          {npsProjectionData.map((d, index) => (
                            <tr key={d.month} className="border-b border-slate-100 last:border-0">
                              <td className="p-2 font-medium">{d.month}</td>
                              <td className="p-2"><Input type="number" value={d.prom} onChange={e => handleProjectionChange(index, 'prom', e.target.value)} disabled={d.status === 'Fechado'} className="text-center"/></td>
                              <td className="p-2"><Input type="number" value={d.neutr} onChange={e => handleProjectionChange(index, 'neutr', e.target.value)} disabled={d.status === 'Fechado'} className="text-center"/></td>
                              <td className="p-2"><Input type="number" value={d.detra} onChange={e => handleProjectionChange(index, 'detra', e.target.value)} disabled={d.status === 'Fechado'} className="text-center"/></td>
                              <td className="p-2 text-center font-medium text-slate-600">{d.totalVolume}</td>
                              <td className="p-2 text-center font-bold" style={{color: 'var(--primary-red)'}}>{d.npsCx}%</td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                    {/* CARD DE RESULTADO ANUAL */}
                    <div className="mt-6 p-4 bg-slate-800 rounded-lg text-white">
                        <h4 className="font-semibold text-lg text-center">Resultado Anual Projetado</h4>
                        <div className="mt-4 grid grid-cols-2 md:grid-cols-5 gap-4 text-center">
                            <div><p className="text-sm text-slate-300">Promotores</p><p className="text-2xl font-bold">{annualTotals.totalProm}</p></div>
                            <div><p className="text-sm text-slate-300">Neutros</p><p className="text-2xl font-bold">{annualTotals.totalNeutr}</p></div>
                            <div><p className="text-sm text-slate-300">Detratores</p><p className="text-2xl font-bold">{annualTotals.totalDetra}</p></div>
                            <div><p className="text-sm text-slate-300">Volume Total</p><p className="text-2xl font-bold">{annualTotals.totalVolume}</p></div>
                            <div className="col-span-2 md:col-span-1 mt-2 md:mt-0 p-3 rounded-lg bg-red-600"><p className="text-sm text-white/80">NPS Anual</p><p className="text-3xl font-bold">{annualTotals.annualNps}%</p></div>
                        </div>
                    </div>
                  </TabsContent>
                  
                  <TabsContent value="inverse">
                     <Card className="mt-6 bg-slate-50 border-slate-200">
                        <CardHeader>
                            <CardTitle className="text-xl">Resultados para a Meta de NPS 95</CardTitle>
                            <CardDescription>Informe o volume total de notas mensal para ver a distribuição necessária.</CardDescription>
                        </CardHeader>
                        <CardContent>
                           <div className="flex items-end gap-4 mb-6">
                                <div className="flex-grow"><Label htmlFor="total-notas">Volume Total de Notas por Mês</Label><Input id="total-notas" type="number" value={totalNotas} onChange={e => setTotalNotas(parseInt(e.target.value) || 0)} className="mt-2"/></div>
                                <Button onClick={handleInverseCalculation} style={{backgroundColor: 'var(--success-green)'}} className="text-white shadow-lg hover:opacity-90">Calcular Meta</Button>
                           </div>
                           {inverseResults.length > 0 && (
                             <div className="overflow-x-auto">
                                <table className="w-full text-sm">
                                  <thead>
                                    <tr style={{backgroundColor: 'var(--success-green)'}} className="text-white">
                                      <th className="p-3 text-center font-semibold rounded-l-lg">Mês</th>
                                      <th className="p-3 text-center font-semibold">Total Notas</th>
                                      <th className="p-3 text-center font-semibold">Promotores</th>
                                      <th className="p-3 text-center font-semibold">Detratores</th>
                                      <th className="p-3 text-center font-semibold">Neutros</th>
                                      <th className="p-3 text-center font-semibold rounded-r-lg">NPS Calculado</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    {inverseResults.map(r => (
                                      <tr key={r.month} className="border-b border-slate-100 last:border-0">
                                        <td className="p-2 text-center font-medium">{r.month}</td>
                                        <td className="p-2 text-center">{r.totalNotas}</td>
                                        <td className="p-2 text-center text-green-700 font-medium">{r.promotores}</td>
                                        <td className="p-2 text-center text-red-700 font-medium">{r.detratores}</td>
                                        <td className="p-2 text-center text-slate-600">{r.neutros}</td>
                                        <td className="p-2 text-center font-bold" style={{color: 'var(--success-green)'}}>{r.npsCalculado}%</td>
                                      </tr>
                                    ))}
                                  </tbody>
                                </table>
                             </div>
                           )}
                        </CardContent>
                     </Card>
                  </TabsContent>
                </Tabs>
              </CardContent>
            </Card>

            <Card>
              <CardHeader><CardTitle>Gráfico de Projeção do NPS CX</CardTitle></CardHeader>
              <CardContent>
                <ResponsiveContainer width="100%" height={300}>
                  <LineChart data={npsProjectionData} margin={{ top: 5, right: 20, left: -10, bottom: 5 }}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
                    <XAxis dataKey="month" tick={{fill: '#64748b'}} />
                    <YAxis tick={{fill: '#64748b'}} />
                    <Tooltip contentStyle={{backgroundColor: '#ffffff', border: '1px solid #e2e8f0', borderRadius: '0.5rem'}}/>
                    <Legend />
                    <Line type="monotone" dataKey="npsCx" name="NPS CX Projetado" stroke="#C51A3A" strokeWidth={3} activeDot={{ r: 8 }} dot={{ r: 5 }} />
                  </LineChart>
                </ResponsiveContainer>
                <div className="mt-4 text-center">
                  <p className="text-lg text-slate-600">
                    NPS CX Final Projetado: <span className="text-2xl font-bold" style={{color: 'var(--primary-red)'}}>{npsProjectionData[npsProjectionData.length - 1]?.npsCx}%</span>
                  </p>
                </div>
              </CardContent>
            </Card>

            <footer className="text-center pb-4">
              <p className="text-sm text-slate-500">Desenvolvido por Adriana Paiva</p>
            </footer>
          </div>
        );
      };

      ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    };
  </script>
</body>
</html>